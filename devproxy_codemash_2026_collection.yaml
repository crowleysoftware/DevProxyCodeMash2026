type: collection.insomnia.rest/5.0
schema_version: "5.1"
name: DevProxy
meta:
  id: wrk_74bb4bf55e9e42db915e5459c77eabe5
  created: 1764797759402
  modified: 1764858189939
  description: Import this into Insomnia to run the same requests that were
    demonstrated in the CodeMash presentation
collection:
  - name: 1 Default Config
    meta:
      id: fld_c114e6b883724b4daacf4a2401e18b80
      created: 1764797815376
      modified: 1764860710949
      sortKey: -1764856708415
      description: >
        # Default Configuration


        This example demonstrates how Dev Proxy works if you simply start it up
        without any custom configuration.


        All other examples will have a custom devproxyrc.json file but this
        example just uses the default configuration that is installed (on
        Windows) at C:\Users\<your user>\AppData\Local\Programs\Dev Proxy


        The default config gives you retry and generic errors. It only
        intercepts requests for `https://jsonplaceholder.typicode.com/*`


        ## Steps:

        1. Run `devproxy` at the command prompt from any folder that does not
        already contain a devproxyrc.json file so that you are sure to get the
        "in-the-box" configuration.

        1. Make requests to jsonplacehoder, for example:
        https://jsonplaceholder.typicode.com/posts/1

        1. Observe the random errors and successes as you repeat the request.


        > DevProxy default config for reference


        ````

        {
          "$schema": "https://raw.githubusercontent.com/dotnet/dev-proxy/main/schemas/v2.0.0/rc.schema.json",
          "plugins": [
            {
              "name": "RetryAfterPlugin",
              "enabled": true,
              "pluginPath": "~appFolder/plugins/DevProxy.Plugins.dll"
            },
            {
              "name": "GenericRandomErrorPlugin",
              "enabled": true,
              "pluginPath": "~appFolder/plugins/DevProxy.Plugins.dll",
              "configSection": "genericRandomErrorPlugin"
            }
          ],
          "urlsToWatch": [
            "https://jsonplaceholder.typicode.com/*"
          ],
          "genericRandomErrorPlugin": {
            "$schema": "https://raw.githubusercontent.com/dotnet/dev-proxy/main/schemas/v2.0.0/genericrandomerrorplugin.schema.json",
            "errorsFile": "devproxy-errors.json",
            "rate": 50
          },
          "logLevel": "information",
          "newVersionNotification": "stable",
          "showSkipMessages": true,
          "showTimestamps": true,
          "validateSchemas": true
        }

        ````
    children:
      - url: https://jsonplaceholder.typicode.com/posts
        name: Posts
        meta:
          id: req_9d8487b29c8e432f884f3da53e79f98f
          created: 1764797759422
          modified: 1764856814170
          isPrivate: false
          description: ""
          sortKey: -1764856814147
        method: GET
        headers:
          - name: User-Agent
            value: insomnia/12.1.0
            description: ""
            disabled: false
        settings:
          renderRequestBody: true
          encodeUrl: true
          followRedirects: global
          cookies:
            send: true
            store: true
          rebuildPath: true
  - name: 2 Custom Random Error
    meta:
      id: fld_763cf0fc4f7146698910c69cd0240b33
      created: 1764856708315
      modified: 1764857259250
      sortKey: -1764856708390
      description: ""
    children:
      - url: https://jsonplaceholder.typicode.com/todos/1
        name: Todos
        meta:
          id: req_53f0c1e1c0fc4452971b39b0d7e8a2dd
          created: 1764856714430
          modified: 1764856913650
          isPrivate: false
          description: ""
          sortKey: -1764856714430
        method: GET
        headers:
          - name: User-Agent
            value: insomnia/12.1.0
            description: ""
            disabled: false
        settings:
          renderRequestBody: true
          encodeUrl: true
          followRedirects: global
          cookies:
            send: true
            store: true
          rebuildPath: true
      - url: https://jsonplaceholder.typicode.com/users/1
        name: Users
        meta:
          id: req_21a348453c8044c9ae8703c5989de22e
          created: 1764856739066
          modified: 1764856906767
          isPrivate: false
          description: ""
          sortKey: -1764856714530
        method: GET
        headers:
          - name: User-Agent
            value: insomnia/12.1.0
            description: ""
            disabled: false
        settings:
          renderRequestBody: true
          encodeUrl: true
          followRedirects: global
          cookies:
            send: true
            store: true
          rebuildPath: true
  - name: 3 Rate Limit
    meta:
      id: fld_49d67089614a41aebb56e4a52fe85570
      created: 1764857220033
      modified: 1764882424702
      sortKey: -1764856708383.75
      description: ""
    children:
      - url: https://jsonplaceholder.typicode.com/posts/1
        name: Posts
        meta:
          id: req_d52be1ae0efe496981f98c887120da91
          created: 1764857327781
          modified: 1764862260958
          isPrivate: false
          description: |-
            # Rate Limit Plugin

            While you can certainly return 429 from any custom error file, this plugin is better at simulating a real world rate limiting scenario.

            Given the following config...

            ```
            1. {
            2.    "$schema": "https://raw.githubusercontent.com/dotnet/dev-proxy/main/schemas/v0.25.0/rc.schema.json",
            3.    "plugins": [
            4.        {
            5.            "name": "RateLimitingPlugin",
            6.            "enabled": true,
            7.            "pluginPath": "~appFolder/plugins/dev-proxy-plugins.dll",
            8.            "configSection": "rateLimiting"
            9.        }
            10.    ],
            11.     "rateLimiting": {
            12.        "costPerRequest": 1,
            13.        "rateLimit": 3,
            14.        "resetTimeWindowSeconds" : 10
            15.    },
            16.    "urlsToWatch": [
            17.        "https://jsonplaceholder.typicode.com/*"
            18.    ],
            19.    "logLevel": "information",
            20.    "newVersionNotification": "stable",
            21.    "showSkipMessages": true
            22. }
            ```

            ... requests will be throttled if you exceed more than 3 per 10 second sliding window. 

            Run the request and observe how "Resources remaining" goes down until you have none left, at which point you get throttled. Every 10 seconds your allotment resets.

            A simple error response would not simulate this behavior.

            ## How It Works

            - **Cost Per Request**: How many “credits” each request consumes.  
            - **Rate Limit**: The maximum number of credits you can use within the specified time window.  
            - **Reset Time Window**: The time (in seconds) after which your credits are replenished.  

            ## Usage Tips

            1. **Local Development**  
               - Edit the `rateLimit` parameters in your configuration based on your needs.  
            2. **Monitoring**  
               - Use logs to see when you’ve reached the request limit.  
            3. **Handling 429 Errors**  
               - If throttled, you’ll receive a `429 Too Many Requests` response. You can then retry after the reset interval.  
          sortKey: -1764857327781
        method: GET
        headers:
          - name: User-Agent
            value: insomnia/12.1.0
            description: ""
            disabled: false
        scripts:
          afterResponse: |+
            
            const statusCode = insomnia.response.code;

            insomnia.test('Check if status is 200', () => {
                insomnia.expect(insomnia.response.code).to.eql(200);
            });



        settings:
          renderRequestBody: true
          encodeUrl: true
          followRedirects: global
          cookies:
            send: true
            store: true
          rebuildPath: true
  - name: 4 Mock
    meta:
      id: fld_a8bde68deeab407398dc9ac3ec46c843
      created: 1764882413111
      modified: 1764945290625
      sortKey: -1764856708383.5547
      description: >-
        ### Mock response


        1. Obtain an API key for free at https://api.nasa.gov/

        1. Set an Insomnia nasa_key environment variable or just paste it over
        the variable in the request URL.

        1. Run the APOD request. Edit `mock-request.json` and observe how the
        response changes.
    children:
      - url: https://api.nasa.gov/planetary/apod
        name: APOD
        meta:
          id: req_d82b6803a5ad403e9f63d75c5e66c3c9
          created: 1764882657907
          modified: 1764883620110
          isPrivate: false
          description: ""
          sortKey: -1764882657907
        method: GET
        parameters:
          - name: api_key
            value: "{{nasa_key}}"
            description: ""
            disabled: false
            type: text
            multiline: false
        headers:
          - name: User-Agent
            value: insomnia/12.1.0
            description: ""
            disabled: false
        scripts:
          afterResponse: |+
            
            const jsonBody = insomnia.response.json();
            const url = jsonBody.url;

            if(jsonBody.media_type === "image") {
            	
            	const resp = await insomnia.sendRequest(
            		url,
            		(err, resp) => {
            			if (err != null) {
            				throw err;
            			}
            		}
            	);
            }

        settings:
          renderRequestBody: true
          encodeUrl: true
          followRedirects: global
          cookies:
            send: true
            store: true
          rebuildPath: true
  - name: 5 File Response
    meta:
      id: fld_016ab20a9f96429dada778fe79a516f2
      created: 1764885256030
      modified: 1765118112881
      sortKey: -1764856708383.5059
      description: >-
        ### Respond with contents of file


        #### If you are not familiar with mocks yet, see this first -
        [MockGenerator](../MockGenerator/README.md)


        1. Using a browser so you can see the image response, go to any NASA
        Picture of the Day. For example:
        https://apod.nasa.gov/apod/image/2503/iss072e574593_DonPetit2048.jpg

        1. Now run devproxy from this folder.

        1. Refresh the browser to see the mock response return the static image.


        The "body" property of mock.json refers to a local file - apod.png. It
        uses the "@" syntax to direct Dev Proxy to respond with the contents of
        a file.


        `"body": "@apod.png",`
    children:
      - url: https://apod.nasa.gov/apod/
        name: APOD
        meta:
          id: req_8f1b6ad26343461ea092373934c126c0
          created: 1764885344785
          modified: 1764945039191
          isPrivate: false
          description: >-
            ### Respond with contents of file


            #### If you are not familiar with mocks yet, see this first -
            [MockGenerator](../MockGenerator/README.md)


            1. Using a browser so you can see the image response, go to any NASA
            Picture of the Day. For example:
            https://apod.nasa.gov/apod/image/2503/iss072e574593_DonPetit2048.jpg

            1. Now run devproxy from this folder.

            1. Refresh the browser to see the mock response return the static
            image.


            The "body" property of mock.json refers to a local file - apod.png.
            It uses the "@" syntax to direct Dev Proxy to respond with the
            contents of a file.


            `"body": "@apod.png",`
          sortKey: -1764885344785
        method: GET
        headers:
          - name: User-Agent
            value: insomnia/12.1.0
            description: ""
            disabled: false
          - name: Cache-Control
            value: no-cache
            description: ""
            disabled: false
        settings:
          renderRequestBody: true
          encodeUrl: true
          followRedirects: global
          cookies:
            send: true
            store: true
          rebuildPath: true
  - name: 6 Mock Generator
    meta:
      id: fld_91df8fcc2aba4a2d9a4f62b30c96fcac
      created: 1764945255112
      modified: 1765118109707
      sortKey: -1764856708383.457
      description: >-
        ## To generate a mock response file :


        1. run `devproxy`

        1. start recording (press "r" in the terminal)

        1. execute the requests you want to generate mocks for

        1. stop recording (press "s" in the terminal)


        Once recording stops a json file will be created in the current working
        folder. If the response body is binary, like an image, then there will
        also be a .bin file created. The bin file is referenced from the json
        with the same syntax used in the "5 File Response" example.

         Use that file as the value for `mockFile` when configuring the mockResponsePlugin (see 4 Mock).
    children:
      - url: https://api.nasa.gov/planetary/apod?api_key={{nasa_key}}
        name: APOD API
        meta:
          id: req_5ce44befea5d4c83944bf5aa5ea27298
          created: 1764945341645
          modified: 1764947635042
          isPrivate: false
          description: This request will set a variable named imgUrl. The value is pulled
            out of the response body and is the url of the image file for
            astronomy picture of the day. That variable is used by the next
            request (APOD) to retrieve today's image.
          sortKey: -1764945414620
        method: GET
        headers:
          - name: User-Agent
            value: insomnia/12.1.0
            description: ""
            disabled: false
        scripts:
          afterResponse: |-
            const jsonBody = insomnia.response.json();
            const url = jsonBody.url;

            if(jsonBody.media_type === "image") {
            	
            	const myFolder = insomnia.parentFolders.get('6 Mock Generator');
            	if (myFolder === undefined) {
            		throw Error('myFolder not found');
            	}
            	myFolder.environment.set('imgUrl', url);
            }
        settings:
          renderRequestBody: true
          encodeUrl: true
          followRedirects: global
          cookies:
            send: true
            store: true
          rebuildPath: true
      - url: "{{imgUrl}}"
        name: APOD
        meta:
          id: req_0043fbab8e524c959e24059128a1fcea
          created: 1764945487395
          modified: 1764947947344
          isPrivate: false
          description: >
            Direct link to the image for Astronomy Picture of the Day. Be aware
            that if the APOD is not an image (could be a video) then this won't
            work because there is a script on the APOD API request to only set
            imgUrl variable when the response body identifies the media type as
            an image.
          sortKey: -1764945414520
        method: GET
        headers:
          - name: User-Agent
            value: insomnia/12.1.0
            description: ""
            disabled: false
        settings:
          renderRequestBody: true
          encodeUrl: true
          followRedirects: global
          cookies:
            send: true
            store: true
          rebuildPath: true
    environment:
      imgUrl: https://apod.nasa.gov/apod/image/2512/sunspectrum_mpso_1080.jpg
  - name: 7 Discover
    meta:
      id: fld_5ff7b0f3adcd40a6a2a3a74fd82fc1e1
      created: 1765117689936
      modified: 1765118687021
      sortKey: -1764856708383.164
      description: ""
    children:
      - url: https://learn.microsoft.com/en-us/microsoft-cloud/dev/dev-proxy/overview
        name: Simulate an app
        meta:
          id: req_6c7d75baac854724ad287830789b411b
          created: 1765118131177
          modified: 1765118683284
          isPrivate: false
          description: >+
            
            ### Discovers URLs that your app is calling so you know what to use
            for urlsToWatch configuration


            The devproxyrc.json file in this folder is an exact copy of
            ~appFolder/presets/urls-to-watch.json.


            This is for demonstration only, normally to discover urls you don't
            create your own config file, you just use the already supplied one:


            ```

            devproxy --config-file "~appFolder\config\urls-to-watch.json"
            --watch-process-names msedge

            ```


            Replace "msedge" with the name of the process to watch.

            When you have finished operating your app to discover URLs, stop
            proxy with ctrl+c. The plain text reporter will generate a txt file
            that lists the discovered urls.

          sortKey: -1765118131177
        method: GET
        headers:
          - name: User-Agent
            value: insomnia/12.1.0
            description: ""
            disabled: false
        scripts:
          afterResponse: >
            
            await insomnia.sendRequest(
            	'https://learn.microsoft.com/en-us/microsoft-cloud/dev/dev-proxy/how-to/test-my-app-with-random-errors',
            	(err, resp) => {
            		if (err != null) {
            			throw err;
            		}
            	}
            );


            await insomnia.sendRequest(
            	'https://learn.microsoft.com/en-us/microsoft-cloud/dev/dev-proxy/how-to/simulate-rate-limit-api-responses',
            	(err, resp) => {
            		if (err != null) {
            			throw err;
            		}
            	}
            );


            await insomnia.sendRequest(
            	'https://learn.microsoft.com/en-us/microsoft-cloud/dev/dev-proxy/how-to/simulate-crud-api',
            	(err, resp) => {
            		if (err != null) {
            			throw err;
            		}
            	}
            );
        settings:
          renderRequestBody: true
          encodeUrl: true
          followRedirects: global
          cookies:
            send: true
            store: true
          rebuildPath: true
cookieJar:
  name: Default Jar
  meta:
    id: jar_4b6f5908145a84f3ea823d3c2a7e5ded3df1d6d1
    created: 1764797759417
    modified: 1765118687010
environments:
  name: Base Environment
  meta:
    id: env_4b6f5908145a84f3ea823d3c2a7e5ded3df1d6d1
    created: 1764797759415
    modified: 1765118687019
    isPrivate: false
